name: "Code for Life - Python - Docs"
description: "Documents python code written in the CFL workspace."
inputs:
  python-version:
    description: "The python version to set up."
    required: true
    default: "3.8"
  working-directory:
    description: "The current working directory."
    required: true
    default: "."
  graph-django-models:
    description: "If there are Django models to graph."
    required: true
    default: "true"
runs:
  using: composite
  steps:
    - name: üõ´ Checkout
      uses: actions/checkout@v4

    - name: üêç Set up Python ${{ inputs.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ inputs.python-version }}

    - name: üõ† Install Dependencies
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: |
        python -m pip install --upgrade pip
        python -m pip install pipenv
        pipenv install --dev

    - name: üìà Graph Django Models
      if: inputs.graph-django-models == 'true'
      shell: bash
      working-directory: ${{ inputs.working-directory }}
      run: pipenv run python manage.py graph_models

    - uses: ocadotechnology/codeforlife-workspace/.github/actions/git/setup-bot@actions # TODO: use @main
      if: inputs.graph-django-models == 'true'

    - uses: ocadotechnology/codeforlife-workspace/.github/actions/git/commit-and-push@actions # TODO: use @main
      if: inputs.graph-django-models == 'true'
      with:
        add: docs/entity_relationship_diagram.png
        commit-message: "entity relationship diagram"
