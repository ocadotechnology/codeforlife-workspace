name: Verify New Contributor 2

on:
  workflow_dispatch:
    inputs:
      pull-request-number:
        description: "The number of the new contributor's PR."
        required: true

jobs:
  validate-pr-review-state:
    uses: ocadotechnology/codeforlife-workspace/.github/workflows/validate-pull-request.yaml@new_contributor_validations # TODO: use @main
    secrets:
      GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    with:
      number: ${{ inputs.pull-request-number }}
      review-state: APPROVED

  validate-new-contributor:
    needs: [validate-pr-review-state]
    uses: ocadotechnology/codeforlife-workspace/.github/workflows/validate-new-contributor.yaml@new_contributor_validations # TODO: use @main

  verify-new-contributor:
    needs: [validate-new-contributor]
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ“§ Send Verification Email
        uses: ocadotechnology/codeforlife-workspace/.github/actions/python/send-email@new_contributor_validations # TODO: use @main
        with:
          auth: ${{ secrets.DOTDIGITAL_API_USER_AUTH }}
          to-addresses: '["${{ env.CONTRIBUTOR_EMAIL_ADDRESS }}"]'
          campaign-id: 1506387
          personalization-values: '[{"name": "PR_URL", "value": "${{ github.event.pull_request.html_url }}"}]'
